{% extends 'base.html' %}
{% load static %}

{% block title %}Create CV{% endblock title %}

{% block content %}
<form method="POST">
    {% csrf_token %}
    
    <h3>Contact Details</h3>
    <div class="form-group">
        <label for="id_name">Full Name:</label>
        <input type="text" name="name" maxlength="255" required="" id="id_name">
    </div>
    <div class="form-group">
        <label for="id_linkedin_profile">LinkedIn Profile:</label>
        <input type="url" name="linkedin_profile" maxlength="200" id="id_linkedin_profile">
    </div>
    <div class="form-group">
        <label for="id_email">Email Address:</label>
        <input type="email" name="email" maxlength="254" required="" id="id_email">
    </div>
    <div class="form-group">
        <label for="id_phone_number">Phone Number:</label>
        <input type="text" name="phone_number" maxlength="15" required="" id="id_phone_number">
    </div>
    <div class="form-group">
        <label for="id_location">Location:</label>
        <input type="text" name="location" maxlength="255" required="" id="id_location">
    </div>

    <h3>Personal Profile</h3>
    <div class="form-group">
        <label for="id_description">Profile Description:</label>
        <textarea name="description" cols="40" rows="10" required="" id="id_description"></textarea>
    </div>

    <!-- Education -->
    <h3>Education</h3>
    <div id="education-formset">
        {{ education_formset.management_form }}
        {% for form in education_formset %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_education-{{ forloop.counter0 }}-start_year">Start Year:</label>
                    {{ form.start_year }}
                </div>
                <div class="form-group">
                    <label for="id_education-{{ forloop.counter0 }}-end_year">End Year:</label>
                    {{ form.end_year }}
                </div>
                <div class="form-group">
                    <label for="id_education-{{ forloop.counter0 }}-school">School Name:</label>
                    {{ form.school }}
                </div>
                <div class="form-group">
                    <label for="id_education-{{ forloop.counter0 }}-area_of_study">Area of Study:</label>
                    {{ form.area_of_study }}
                </div>
                <div class="form-group">
                    <label for="id_education-{{ forloop.counter0 }}-result">Result:</label>
                    {{ form.result }}
                </div>

                <button type="button" class="remove-form">Remove</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-education">Add Education</button>

    <!-- Hackathons -->
    <h3>Hackathons</h3>
    <div id="hackathon-formset">
        {{ hackathon_formset.management_form }}
        {% for form in hackathon_formset %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_hackathon-{{ forloop.counter0 }}-year_month">Year/Month:</label>
                    {{ form.year_month }}
                </div>
                <div class="form-group">
                    <label for="id_hackathon-{{ forloop.counter0 }}-github_link">GitHub Link:</label>
                    {{ form.github_link }}
                </div>
                <div class="form-group">
                    <label for="id_hackathon-{{ forloop.counter0 }}-hosts">Host Organization:</label>
                    {{ form.hosts }}
                </div>
                <div class="form-group">
                    <label for="id_hackathon-{{ forloop.counter0 }}-competition_name">Competition Name:</label>
                    {{ form.competition_name }}
                </div>
                <div class="form-group">
                    <label for="id_hackathon-{{ forloop.counter0 }}-role">Role:</label>
                    {{ form.role }}
                </div>

                <button type="button" class="remove-form">Remove</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-hackathon">Add Hackathon</button>

    <!-- Projects -->
    <h3>Projects</h3>
    <div id="projects-formset">
        {{ project_formset.management_form }}
        {% for form in project_formset %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_projects-{{ forloop.counter0 }}-project_name">Project Name:</label>
                    {{ form.project_name }}
                </div>
                <div class="form-group">
                    <label for="id_projects-{{ forloop.counter0 }}-live_link">Live Link:</label>
                    {{ form.live_link }}
                </div>
                <div class="form-group">
                    <label for="id_projects-{{ forloop.counter0 }}-github_link">GitHub Link:</label>
                    {{ form.github_link }}
                </div>
                <div class="form-group">
                    <label for="id_projects-{{ forloop.counter0 }}-skills">Skills:</label>
                    {{ form.skills }}
                </div>
                <div class="form-group">
                    <label for="id_projects-{{ forloop.counter0 }}-description">Project Description:</label>
                    {{ form.description }}
                </div>

                <button type="button" class="remove-form">Remove</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-project">Add Project</button>

    <!-- Jobs -->
    <h3>Jobs</h3>
    <div id="jobs-formset">
        {{ job_formset.management_form }}
        {% for form in job_formset %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-job_title">Job Title:</label>
                    {{ form.job_title }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-company">Company Name:</label>
                    {{ form.company }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-start_date">Start Date:</label>
                    {{ form.start_date }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-end_date">End Date:</label>
                    {{ form.end_date }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-bullet_point_1">Bullet Point 1:</label>
                    {{ form.bullet_point_1 }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-bullet_point_2">Bullet Point 2:</label>
                    {{ form.bullet_point_2 }}
                </div>
                <div class="form-group">
                    <label for="id_jobs-{{ forloop.counter0 }}-bullet_point_3">Bullet Point 3:</label>
                    {{ form.bullet_point_3 }}
                </div>

                <button type="button" class="remove-form">Remove</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-job">Add Job</button>

    <!-- Soft Skills -->
    <h3>Soft Skills</h3>
    <div id="softskills-formset">
        {{ soft_skill_formset.management_form }}
        {% for form in soft_skill_formset %}
            <div class="form-row">
                <div class="form-group">
                    <label for="id_softskills-{{ forloop.counter0 }}-group_name">Skill Group:</label>
                    {{ form.group_name }}
                </div>
                <div class="form-group">
                    <label for="id_softskills-{{ forloop.counter0 }}-short_description">Description:</label>
                    {{ form.short_description }}
                </div>

                <button type="button" class="remove-form">Remove</button>
            </div>
        {% endfor %}
    </div>
    <button type="button" id="add-softskill">Add Soft Skill</button>

    <button type="submit">Submit</button>
</form>


<script>
    function cloneMore(selector, prefix) {
        let newElement = $(selector).clone(true);  // Clone the last form in the formset
        let total = $('#id_' + prefix + '-TOTAL_FORMS').val();  // Get the current total number of forms
    
        // Update the form elements in the newly cloned form
        newElement.find(':input').each(function () {
            // Check if the element has a 'name' attribute
            let name = $(this).attr('name');
            if (name) {
                let newName = name.replace('-' + (total - 1) + '-', '-' + total + '-');
                $(this).attr('name', newName);  // Update the name attribute
            }
    
            // Check if the element has an 'id' attribute
            let id = $(this).attr('id');
            if (id) {
                let newId = id.replace('-' + (total - 1) + '-', '-' + total + '-');
                $(this).attr('id', newId);  // Update the id attribute
            }
    
    
            // Check if the element has an 'id' attribute
            let for_tag = $(this).attr('for');
            if (for_tag) {
                let newFor = for_tag.replace('-' + (total - 1) + '-', '-' + total + '-');
                $(this).attr('for', newFor);  // Update the id attribute
            }
    
            // Clear the value (to avoid copying existing input values)
            if ($(this).is('input[type="text"], input[type="number"], input[type="url"], textarea')) {
                $(this).val('');  // Clear text, number, URL fields
            } else if ($(this).is('input[type="checkbox"]')) {
                $(this).prop('checked', false);  // Uncheck checkboxes
            }
        });
    
        total++;
        $('#id_' + prefix + '-TOTAL_FORMS').val(total);  // Increment the TOTAL_FORMS count
    
        // Append the newly cloned form to the formset
        $(selector).parent().append(newElement);
    }
    

    $('#add-education').click(function () {
        cloneMore('#education-formset .form-row:last', 'education');
    });

    $('#add-hackathon').click(function () {
        cloneMore('#hackathon-formset .form-row:last', 'hackathon');
    });

    $('#add-skill').click(function () {
        cloneMore('#skills-formset .form-row:last', 'skills');
    });

    $('#add-project').click(function () {
        cloneMore('#projects-formset .form-row:last', 'projects');
    });

    $('#add-job').click(function () {
        cloneMore('#jobs-formset .form-row:last', 'jobs');
    });

    $('#add-softskill').click(function () {
        cloneMore('#softskills-formset .form-row:last', 'softskills');
    });

    function toggleRemoveButtons(formset) {
        let totalForms = formset.find('.form-row').length;
    
        formset.find('.remove-form').each(function () {
            if (totalForms === 1) {
                $(this).prop('disabled', true);  // Disable remove button if only one form left
            } else {
                $(this).prop('disabled', false);  // Enable remove buttons otherwise
            }
        });
    }
    
    // Call this function every time a form is added or removed
    $(document).on('click', '.remove-form', function () {
        let formset = $(this).closest('.form-row').parent();
        let totalForms = formset.find('.form-row').length;
    
        if (totalForms > 1) {
            $(this).parent().remove();
            toggleRemoveButtons(formset);
        }
    });
    
    
</script>
{% endblock %}
